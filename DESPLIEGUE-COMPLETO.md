# üöÄ DESPLIEGUE COMPLETO - El Nopal Restaurant

## üìã TUS DATOS ESPEC√çFICOS
- **VPS IP**: `5.250.190.97`
- **Dominio**: `elnopal.es` ‚úÖ (DNS ya configurado)
- **Email**: `reservas@elnopal.es`
- **Usuario SSH**: `root`

---

## ‚ö° PASOS COMPLETOS (22 minutos total)

### üîß PASO 1: Configurar Gmail (5 minutos)

1. Ve a [myaccount.google.com](https://myaccount.google.com)
2. **Seguridad** ‚Üí **Verificaci√≥n en 2 pasos** ‚Üí Habilitar
3. **Contrase√±as de aplicaciones** ‚Üí Generar nueva
4. Nombre: `El Nopal Restaurant`
5. **¬°IMPORTANTE!** Copia la contrase√±a de 16 caracteres y gu√°rdala

---

### üì¶ PASO 2: Crear Repositorio Git (3 minutos)

**Crear repositorio en GitHub:**
1. Ve a [github.com](https://github.com) y crea cuenta si no tienes
2. Clic en **"New repository"** (bot√≥n verde)
3. **Configuraci√≥n del repositorio:**
   - **Nombre**: `elnopal`
   - **Descripci√≥n**: `Sistema de gesti√≥n para El Nopal Restaurant`
   - **Visibilidad**: 
     - ‚úÖ **P√∫blico** (Recomendado para primer despliegue - m√°s f√°cil)
     - üîí **Privado** (M√°s seguro pero requiere configuraci√≥n SSH)
   - **‚ö†Ô∏è IMPORTANTE**: **NO marcar** "Add README", ".gitignore" ni "license" (ya los tienes)
4. Clic **"Create repository"**
5. **¬°Deja la p√°gina abierta!** La necesitar√°s para el siguiente paso

**üí° Recomendaci√≥n:** Usa **p√∫blico** para el primer despliegue (m√°s simple), luego puedes cambiarlo a privado.

https://github.com/yalilms/elnopal.git
---

### üì§ PASO 3: Limpiar y Subir C√≥digo al Repositorio (3 minutos)

**Desde PowerShell en tu proyecto:**
```powershell
# Ir a tu proyecto
cd C:\Users\yalil\Documents\Unity\ELNOPAL

# Verificar que Git est√© instalado
git --version

# Si no tienes Git, desc√°rgalo de: https://git-scm.com/download/win
```

**¬°IMPORTANTE! Limpiar archivos que no deben subirse:**
```powershell
# Eliminar node_modules (se instalar√°n en el servidor)
Remove-Item -Recurse -Force node_modules -ErrorAction SilentlyContinue
Remove-Item -Recurse -Force server\node_modules -ErrorAction SilentlyContinue
Remove-Item -Recurse -Force client\node_modules -ErrorAction SilentlyContinue

# Eliminar build (se generar√° en el servidor)
Remove-Item -Recurse -Force client\build -ErrorAction SilentlyContinue

# Eliminar archivos .env (contienen secretos)
Remove-Item -Force .env -ErrorAction SilentlyContinue
Remove-Item -Force server\.env -ErrorAction SilentlyContinue
Remove-Item -Force client\.env -ErrorAction SilentlyContinue
```

**Configurar Git (solo la primera vez):**
```bash
git config --global user.name "Tu Nombre"
git config --global user.email "tu@email.com"
```

**Subir el c√≥digo a GitHub:**

1. **Preparar archivos localmente:**
```bash
# Inicializar repositorio (si no est√° hecho)
git init

# Agregar todos los archivos
git add .

# Primer commit
git commit -m "El Nopal Restaurant - Listo para producci√≥n"
```

2. **Subir a GitHub usando la interfaz web:**
   - Ve a tu repositorio en GitHub (https://github.com/TU_USUARIO/elnopal)
   - Clic en **"uploading an existing file"** o **"choose your files"**
   - **Arrastra toda la carpeta ELNOPAL** o selecciona todos los archivos
   - En el mensaje de commit escribe: `"El Nopal Restaurant - Listo para producci√≥n"`
   - Clic en **"Commit changes"**

**Alternativa por terminal (si prefieres):**
```bash
# Conectar con GitHub (CAMBIAR por tu URL real)
git remote add origin https://github.com/TU_USUARIO/elnopal.git

# Subir c√≥digo
git push -u origin main
```

---

### ‚öôÔ∏è PASO 4: Configurar Script de Despliegue (1 minuto)

**Obtener URL del repositorio y configurar script:**

1. **En la p√°gina de GitHub que dejaste abierta**, busca la secci√≥n **"Quick setup"**
2. **Copia la URL HTTPS** (algo como: `https://github.com/TU_USUARIO/elnopal.git`)
3. **Abre el archivo `deploy-git.sh`** con cualquier editor de texto
4. **En la l√≠nea 18**, cambia:
   ```bash
   REPO_URL="https://github.com/TU_USUARIO/elnopal.git"
   ```
   Por tu URL real de GitHub
5. **Guarda el archivo**

**Ejemplo:**
```bash
REPO_URL="https://github.com/yalil/elnopal.git"  # ‚Üê Tu URL aqu√≠
```

---

### üöÄ PASO 5: Ejecutar Despliegue (10 minutos)

**Opci√≥n A: Desde WSL (Recomendado)**
```bash
# Instalar WSL si no lo tienes
wsl --install

# Reiniciar Windows si es necesario

# Desde WSL
cd /mnt/c/Users/yalil/Documents/Unity/ELNOPAL
chmod +x deploy-git.sh
./deploy-git.sh
```

**Opci√≥n B: Desde Git Bash**
```bash
# Descargar Git Bash de: https://git-scm.com/download/win
# Abrir Git Bash y ejecutar:
cd /c/Users/yalil/Documents/Unity/ELNOPAL
chmod +x deploy-git.sh
./deploy-git.sh
```

**¬øQu√© hace este script?**
- Verifica que todo est√© listo
- Sube tu c√≥digo al repositorio
- Configura el VPS autom√°ticamente
- Instala Node.js, MongoDB, Nginx, PM2
- Clona tu repositorio en el servidor
- Construye el proyecto
- Configura Nginx y firewall
- Inicia el backend

---

### üìß PASO 6: Configurar Correo y Seguridad (5 minutos)

**Conectar al VPS y configurar MongoDB seguro y correo:**
```bash
ssh root@5.250.190.97

# 1. Crear usuario administrador para MongoDB
mongo
use admin
db.createUser({
  user: "elnopal_admin",
  pwd: "ElNopal2024_SuperSeguro!",
  roles: ["userAdminAnyDatabase", "dbAdminAnyDatabase", "readWriteAnyDatabase"]
})
use elnopal
db.createUser({
  user: "elnopal_user", 
  pwd: "ElNopal_DB_2024_SuperSeguro!",
  roles: ["readWrite"]
})
exit

# 2. Habilitar autenticaci√≥n en MongoDB
nano /etc/mongod.conf
# Buscar la l√≠nea #security: y cambiarla por:
# security:
#   authorization: enabled

# Reiniciar MongoDB
systemctl restart mongod

# 3. Configurar variables de entorno
nano /var/www/elnopal/server/.env

# Actualizar estas l√≠neas:
MONGODB_URI=mongodb://elnopal_user:ElNopal_DB_2024_SuperSeguro!@localhost:27017/elnopal
EMAIL_PASS=tu-contrase√±a-de-16-caracteres-de-gmail
JWT_SECRET=ElNopal_JWT_SuperSecreto_2024_ProduccionSegura_CambiarEsteValor!

# Guardar: Ctrl+X, luego Y, luego Enter

# 4. Reiniciar el backend
pm2 restart elnopal-backend

# Salir del VPS
exit
```

---

## ‚úÖ VERIFICACI√ìN FINAL

### üåê Probar el Sitio Web
1. **Sitio principal**: http://elnopal.es (IONOS activar√° HTTPS autom√°ticamente)
2. **Panel de administraci√≥n**: http://elnopal.es/admin
   - Usuario: `admin@elnopal.es`
   - Contrase√±a: `Admin123!Seguro`

### üìß Probar Reservas y Correos
1. Hacer una reserva de prueba desde http://elnopal.es
2. Verificar que llegue el correo a `reservas@elnopal.es`
3. Probar el panel de administraci√≥n

---

## üîÑ ACTUALIZACIONES FUTURAS

**Para actualizar tu sitio despu√©s de hacer cambios:**

**M√©todo R√°pido (Script autom√°tico):**
```bash
# Desde WSL o Git Bash
cd /mnt/c/Users/yalil/Documents/Unity/ELNOPAL
./update-git.sh
```

**M√©todo Manual:**
```bash
# Guardar cambios locales
git add .
git commit -m "Descripci√≥n de los cambios"
git push origin main

# Actualizar en el servidor
ssh root@5.250.190.97
cd /var/www/elnopal
git pull origin main
cd client && npm run build
pm2 restart elnopal-backend
exit
```

## üîí HACER REPOSITORIO PRIVADO (Opcional)

**Despu√©s del primer despliegue, puedes hacer tu repositorio privado:**

1. **En GitHub:**
   - Ve a tu repositorio
   - **Settings** ‚Üí **General** 
   - Scroll hasta **"Danger Zone"**
   - **"Change repository visibility"** ‚Üí **"Make private"**

2. **Configurar acceso SSH en el VPS:**
```bash
ssh root@5.250.190.97

# Generar clave SSH
ssh-keygen -t rsa -b 4096 -C "elnopal@server"
cat ~/.ssh/id_rsa.pub

# Copiar la clave y agregarla en GitHub:
# GitHub ‚Üí Settings ‚Üí SSH and GPG keys ‚Üí New SSH key

# Cambiar URL del repositorio a SSH
cd /var/www/elnopal
git remote set-url origin git@github.com:TU_USUARIO/elnopal.git

# Probar conexi√≥n
git pull origin main
```

---

## üÜò SOLUCI√ìN DE PROBLEMAS

### ‚ùå Error: "git: command not found"
```bash
# Descargar e instalar Git desde:
# https://git-scm.com/download/win
```

### ‚ùå Error: "Permission denied (publickey)"
```bash
# Usar HTTPS en lugar de SSH
# Aseg√∫rate de que tu repositorio sea p√∫blico
```

### ‚ùå Error: "Cannot connect to VPS"
```bash
# Verificar que el VPS est√© encendido en el panel de IONOS
ssh -v root@5.250.190.97
```

### ‚ùå Error 502 Bad Gateway
```bash
ssh root@5.250.190.97
pm2 status
pm2 restart elnopal-backend
systemctl restart nginx
```

### ‚ùå No llegan correos
```bash
ssh root@5.250.190.97
pm2 logs elnopal-backend
# Verificar que EMAIL_PASS est√© configurado correctamente
```

### ‚ùå Problemas con HTTPS
```bash
# IONOS gestiona SSL autom√°ticamente
# Si hay problemas, contactar soporte de IONOS
# Verificar que el dominio apunte correctamente a la IP
```

---

## üìû COMANDOS √öTILES

```bash
# Conectar al VPS
ssh root@5.250.190.97

# Ver estado de todos los servicios
pm2 status
systemctl status nginx
systemctl status mongod

# Ver logs en tiempo real
pm2 logs elnopal-backend
tail -f /var/log/nginx/elnopal_error.log

# Reiniciar servicios
pm2 restart elnopal-backend
systemctl restart nginx
systemctl restart mongod

# Ver espacio en disco
df -h

# Ver uso de memoria
free -h

# Salir del VPS
exit
```

---

## üîí SEGURIDAD IMPLEMENTADA

‚úÖ **MongoDB Autenticado**: Usuario y contrase√±a espec√≠ficos  
‚úÖ **JWT Secreto Fuerte**: Token de autenticaci√≥n seguro  
‚úÖ **Variables de Entorno**: Secretos no en el c√≥digo  
‚úÖ **Firewall Configurado**: Solo puertos necesarios abiertos  
‚úÖ **SSL/HTTPS**: Gestionado autom√°ticamente por IONOS  
‚úÖ **Nginx Hardening**: Headers de seguridad  
‚úÖ **Rate Limiting**: Protecci√≥n contra ataques de fuerza bruta  
‚úÖ **Helmet Security**: Headers de seguridad adicionales  
‚úÖ **Validaci√≥n de Entrada**: Protecci√≥n contra inyecciones  
‚úÖ **Contrase√±as Seguras**: Validaci√≥n de fortaleza  
‚úÖ **Bloqueo de Cuentas**: Protecci√≥n contra intentos m√∫ltiples  

## üõ°Ô∏è NUEVAS CARACTER√çSTICAS DE SEGURIDAD

### üîê **Autenticaci√≥n Mejorada**
- Contrase√±as deben tener m√≠nimo 8 caracteres
- Requiere may√∫sculas, min√∫sculas, n√∫meros y s√≠mbolos
- Bloqueo autom√°tico despu√©s de 5 intentos fallidos
- Desbloqueo autom√°tico despu√©s de 30 minutos

### üö´ **Protecci√≥n contra Ataques**
- Rate limiting: m√°ximo 5 logins por 15 minutos
- Rate limiting general: m√°ximo 100 requests por 15 minutos
- Headers de seguridad con Helmet
- Validaci√≥n estricta de entrada de datos
- Protecci√≥n CORS configurada correctamente

### üîç **Monitoreo y Logs**
- Logs de consola eliminados en producci√≥n
- Manejo seguro de errores sin exposici√≥n de informaci√≥n
- Tokens mock eliminados completamente

## üéØ VENTAJAS DE ESTE M√âTODO

‚úÖ **Profesional**: Usa Git como los desarrolladores reales  
‚úÖ **R√°pido**: Solo transfiere cambios, no todo el proyecto  
‚úÖ **Seguro**: Historial completo de cambios  
‚úÖ **Escalable**: F√°cil agregar m√°s desarrolladores  
‚úÖ **Backup**: Tu c√≥digo est√° seguro en GitHub  
‚úÖ **Actualizaciones**: Un solo comando para actualizar  
‚úÖ **Producci√≥n Lista**: Configuraci√≥n de seguridad empresarial  

---

## üéâ ¬°RESULTADO FINAL!

Una vez completados todos los pasos, tendr√°s:

- **üåê Sitio web**: http://elnopal.es (HTTPS autom√°tico por IONOS)
- **‚öôÔ∏è Panel admin**: http://elnopal.es/admin  
- **üìß Correos**: reservas@elnopal.es
- **üîí SSL**: Gestionado autom√°ticamente por IONOS
- **üì¶ Repositorio**: https://github.com/TU_USUARIO/elnopal
- **üîÑ Actualizaciones**: Simples con Git
- **üõ°Ô∏è Seguridad**: Nivel empresarial con protecciones m√∫ltiples

**¬°El Nopal Restaurant est√° oficialmente online con seguridad de nivel empresarial!** üçΩÔ∏è‚ú®üîí

---

## üìã CHECKLIST FINAL

### üîß **Configuraci√≥n Inicial:**
- [ ] Gmail configurado con contrase√±a de aplicaci√≥n
- [ ] Repositorio GitHub creado (p√∫blico o privado)
- [ ] Archivos sensibles eliminados (node_modules, .env, build)
- [ ] C√≥digo subido al repositorio
- [ ] Script deploy-git.sh configurado con tu URL

### üöÄ **Despliegue:**
- [ ] Despliegue ejecutado exitosamente
- [ ] MongoDB con autenticaci√≥n habilitada
- [ ] Variables de entorno configuradas (.env)
- [ ] Firewall y seguridad configurados

### ‚úÖ **Verificaci√≥n:**
- [ ] Sitio web funcionando (http://elnopal.es)
- [ ] Panel admin accesible (http://elnopal.es/admin)
- [ ] Reservas y correos funcionando
- [ ] Base de datos segura y autenticada
- [ ] HTTPS activado autom√°ticamente por IONOS

### üîí **Seguridad (Opcional):**
- [ ] Repositorio cambiado a privado
- [ ] SSH configurado para acceso privado
- [ ] Contrase√±as de MongoDB personalizadas
- [ ] Rate limiting funcionando
- [ ] Headers de seguridad verificados

**¬°Todo listo para producci√≥n segura de nivel empresarial!** üöÄüîíüõ°Ô∏è 